import{S as e,i as t,s as r,W as a,X as o,e as s,t as n,k as c,j as i,c as l,a as d,g as u,d as f,n as h,m,b as p,f as g,a2 as v,o as $,u as w,w as x,x as b,Y as k,v as V,Z as y,_ as I,$ as j,a1 as E,r as S,C as P,h as U,a8 as F,aS as D,l as N}from"../../../chunks/vendor-db5fc542.js";import{p as q}from"../../../chunks/routing-405c8d47.js";import{T as z}from"../../../chunks/Toast-c21bf6da.js";import{g as M}from"../../../chunks/navigation-51f4a605.js";import{V as _}from"../../../chunks/VersionForm-6ae4abc5.js";import{C as A,x as C,F as T,y as L,z as O}from"../../../chunks/graphql-7b224d75.js";import{b as R}from"../../../chunks/paths-6758d194.js";import"../../../chunks/singletons-12a22614.js";import"../../../chunks/uplugin-0af6f8ad.js";import"../../../chunks/sha256-88abbcfe.js";import"../../../chunks/user-8d7a97c1.js";import"../../../chunks/forms-8d025218.js";import"../../../chunks/markdown-c60b2bfd.js";function H(e){let t,r=e[2].data.getMod.name+"";return{c(){t=n(r)},l(e){t=u(e,r)},m(e,r){g(e,t,r)},p(e,a){4&a&&r!==(r=e[2].data.getMod.name+"")&&U(t,r)},d(e){e&&f(t)}}}function W(e){let t;return{c(){t=n("...")},l(e){t=u(e,"...")},m(e,r){g(e,t,r)},p:F,d(e){e&&f(t)}}}function X(e){let t,r,a,o;t=new _({props:{onSubmit:e[8],modReference:e[2].data.getMod.mod_reference}});let s=e[3]&&B(e);return{c(){i(t.$$.fragment),r=c(),s&&s.c(),a=N()},l(e){m(t.$$.fragment,e),r=h(e),s&&s.l(e),a=N()},m(e,n){$(t,e,n),g(e,r,n),s&&s.m(e,n),g(e,a,n),o=!0},p(e,r){const o={};4&r&&(o.modReference=e[2].data.getMod.mod_reference),t.$set(o),e[3]?s?s.p(e,r):(s=B(e),s.c(),s.m(a.parentNode,a)):s&&(s.d(1),s=null)},i(e){o||(b(t.$$.fragment,e),o=!0)},o(e){w(t.$$.fragment,e),o=!1},d(e){V(t,e),e&&f(r),s&&s.d(e),e&&f(a)}}}function Y(e){let t,r,a,o=e[2].error.message+"";return{c(){t=s("p"),r=n("Oh no... "),a=n(o)},l(e){t=l(e,"P",{});var s=d(t);r=u(s,"Oh no... "),a=u(s,o),s.forEach(f)},m(e,o){g(e,t,o),v(t,r),v(t,a)},p(e,t){4&t&&o!==(o=e[2].error.message+"")&&U(a,o)},i:F,o:F,d(e){e&&f(t)}}}function Z(e){let t,r;return{c(){t=s("p"),r=n("Loading...")},l(e){t=l(e,"P",{});var a=d(t);r=u(a,"Loading..."),a.forEach(f)},m(e,a){g(e,t,a),v(t,r)},p:F,i:F,o:F,d(e){e&&f(t)}}}function B(e){let t,r,a,o,i,m,$,w,x,b,k,V,y,I=e[4].toFixed(0)+"";return{c(){t=s("div"),r=s("div"),a=s("div"),o=s("span"),i=n(e[3]),m=c(),$=s("div"),w=s("span"),x=n(I),b=n("%"),k=c(),V=s("div"),y=s("div"),this.h()},l(s){t=l(s,"DIV",{class:!0});var n=d(t);r=l(n,"DIV",{class:!0});var c=d(r);a=l(c,"DIV",{});var p=d(a);o=l(p,"SPAN",{class:!0});var g=d(o);i=u(g,e[3]),g.forEach(f),p.forEach(f),m=h(c),$=l(c,"DIV",{class:!0});var v=d($);w=l(v,"SPAN",{class:!0});var j=d(w);x=u(j,I),b=u(j,"%"),j.forEach(f),v.forEach(f),c.forEach(f),k=h(n),V=l(n,"DIV",{class:!0});var E=d(V);y=l(E,"DIV",{style:!0,class:!0}),d(y).forEach(f),E.forEach(f),n.forEach(f),this.h()},h(){p(o,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-white bg-yellow-600"),p(w,"class","text-xs font-semibold inline-block text-white"),p($,"class","text-right"),p(r,"class","flex mb-2 items-center justify-between"),D(y,"width",e[4].toFixed(0)+"%"),p(y,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-600"),p(V,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-600"),p(t,"class","relative pt-4")},m(e,s){g(e,t,s),v(t,r),v(r,a),v(a,o),v(o,i),v(r,m),v(r,$),v($,w),v(w,x),v(w,b),v(t,k),v(t,V),v(V,y)},p(e,t){8&t&&U(i,e[3]),16&t&&I!==(I=e[4].toFixed(0)+"")&&U(x,I),16&t&&D(y,"width",e[4].toFixed(0)+"%")},d(e){e&&f(t)}}}function G(e){let t,r;return{c(){t=s("span"),r=n(e[1])},l(a){t=l(a,"SPAN",{});var o=d(t);r=u(o,e[1]),o.forEach(f)},m(e,a){g(e,t,a),v(t,r)},p(e,t){2&t&&U(r,e[1])},d(e){e&&f(t)}}}function J(e){let t,r,y,I,j,E,P,U,F;function D(e,t){return e[2].fetching?W:e[2].error?void 0:H}let N=D(e),q=N&&N(e);const M=[Z,Y,X],_=[];function A(e,t){return e[2].fetching?0:e[2].error?1:2}function C(t){e[10](t)}I=A(e),j=_[I]=M[I](e);let T={$$slots:{default:[G]},$$scope:{ctx:e}};return void 0!==e[0]&&(T.running=e[0]),P=new z({props:T}),a.push((()=>o(P,"running",C))),{c(){t=s("h1"),r=n("New Version for\n  "),q&&q.c(),y=c(),j.c(),E=c(),i(P.$$.fragment),this.h()},l(e){t=l(e,"H1",{class:!0});var a=d(t);r=u(a,"New Version for\n  "),q&&q.l(a),a.forEach(f),y=h(e),j.l(e),E=h(e),m(P.$$.fragment,e),this.h()},h(){p(t,"class","text-4xl my-4 font-bold")},m(e,a){g(e,t,a),v(t,r),q&&q.m(t,null),g(e,y,a),_[I].m(e,a),g(e,E,a),$(P,e,a),F=!0},p(e,[r]){N===(N=D(e))&&q?q.p(e,r):(q&&q.d(1),q=N&&N(e),q&&(q.c(),q.m(t,null)));let a=I;I=A(e),I===a?_[I].p(e,r):(S(),w(_[a],1,1,(()=>{_[a]=null})),x(),j=_[I],j?j.p(e,r):(j=_[I]=M[I](e),j.c()),b(j,1),j.m(E.parentNode,E));const o={};131074&r&&(o.$$scope={dirty:r,ctx:e}),!U&&1&r&&(U=!0,o.running=e[0],k((()=>U=!1))),P.$set(o)},i(e){F||(b(j),b(P.$$.fragment,e),F=!0)},o(e){w(j),w(P.$$.fragment,e),F=!1},d(e){e&&f(t),q&&q.d(),e&&f(y),_[I].d(e),e&&f(E),V(P,e)}}}const K=q();function Q(e,t,r){let a,o,s;var n=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))((function(o,s){function n(e){try{i(a.next(e))}catch(t){s(t)}}function c(e){try{i(a.throw(e))}catch(t){s(t)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,c)}i((a=a.apply(e,t||[])).next())}))};let{modId:c}=t;const i=P("");y(e,i,(e=>r(3,o=e)));const l=P(0);y(e,l,(e=>r(4,s=e)));const d=P();d.subscribe((e=>{e&&(e.uploaded===e.total?(i.set("Processing..."),l.set(100)):(i.set(`Uploading: ${e.uploaded}/${e.total}`),l.set(e.uploaded/e.total*100)))}));let u="",f=!1;const h=I(L,{mod:c});y(e,h,(e=>r(2,a=e))),j(h);const m=E({query:A}),p=E({query:C}),g=E({query:T}),v=I(O,{versionId:void 0,modId:c},{pause:!0});j(v);return e.$$set=e=>{"modId"in e&&r(9,c=e.modId)},e.$$.update=()=>{1&e.$$.dirty&&(f||r(1,u=""))},[f,u,a,o,s,i,l,h,e=>n(void 0,void 0,void 0,(function*(){return(async(e,t,r,a,o)=>{const s=1e7,n=Math.ceil(e.size/s),c=new Array(n).fill(0).map(((e,t)=>t)).reverse(),i=(e,r,a)=>o.uploadVersionPart({modId:t,versionId:a,part:r,file:e});let l=0,d=0;const u=t=>{if(l>=10)return;if(!c.length)return;const r=c.pop(),o=r*s,f=e.slice(o,o+s);return l+=1,Promise.all([i(f,r+1,t).then((()=>(l-=1,a.set({total:n,uploaded:n-c.length-l}),u(t)))).catch((e=>{if(console.error("Upload failed:",e),l-=1,c.push(r),d+=1,d<5)return u(t);throw new Error("Failed uploading after 5 attempts")})),u(t)])};return o.createVersion({modId:t}).then((async e=>(a.set({total:n,uploaded:0}),await u(e.data.createVersion),e.data.createVersion))).then((e=>(console.log("Finalizing",{versionID:e}),o.finalizeCreateVersion({modId:t,versionId:e,version:r}).then((()=>new Promise(((t,r)=>{let a=0;const s=setInterval((()=>{if(60==a)return clearInterval(s),r(new Error("Timed out waiting for mod processing"));o.checkVersionUploadState.reexecute({requestPolicy:"network-only"}),a++}),1e4);o.checkVersionUploadState.variables.versionId=e;const n=o.checkVersionUploadState.subscribe((e=>{if(!e.fetching)return e.error?(clearInterval(s),r(new Error(e.error.message)),void setTimeout(n)):void(e.data&&e.data.checkVersionUploadState&&e.data.checkVersionUploadState.version&&e.data.checkVersionUploadState.version.id&&(n(),clearInterval(s),t(e.data.checkVersionUploadState)))}))}))))))).catch((e=>{throw console.error(e),e}))})(e.file,c,{changelog:e.changelog,stability:e.stability},d,{createVersion:m,uploadVersionPart:p,finalizeCreateVersion:g,checkVersionUploadState:v}).then((e=>{console.log({success:e}),M(R+"/mod/"+c+"/version/"+e.version.id)})).catch((e=>{console.error(e),r(1,u="Error creating version: "+e.message),r(0,f=!0),i.set("")}))})),c,function(e){f=e,r(0,f)}]}class ee extends e{constructor(e){super(),t(this,e,Q,J,r,{modId:9})}}export{ee as default,K as load};
