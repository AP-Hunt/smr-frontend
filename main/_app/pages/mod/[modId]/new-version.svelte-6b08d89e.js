import{S as e,i as t,s as r,W as o,I as n,J as a,l as s,k as c,e as i,t as l,j as d,Z as u,d as f,n as h,c as m,a as p,g,m as v,b as w,Q as x,f as $,o as V,u as k,w as b,x as y,K as I,v as E,L as j,M as S,N as P,P as N,r as U,C as F,h as M,aG as D}from"../../../chunks/vendor-9ef56761.js";import{p as q}from"../../../chunks/routing-1d144003.js";import{T as z}from"../../../chunks/Toast-70852bff.js";import{g as A}from"../../../chunks/navigation-51f4a605.js";import{V as C}from"../../../chunks/VersionForm-5b0f65e8.js";import{x as T,C as _,y as L,z as R,F as O}from"../../../chunks/graphql-7c12eb8b.js";import{b as G}from"../../../chunks/paths-6758d194.js";import"../../../chunks/singletons-12a22614.js";import"../../../chunks/uplugin-421a2e17.js";import"../../../chunks/api-82c76902.js";import"../../../chunks/user-f1838cad.js";import"../../../chunks/forms-8d025218.js";import"../../../chunks/markdown-f46c64ca.js";function H(e){return document.title="New Version: "+e[2].data.getMod.name+" - SMR",{c:o,l:o,m:o,d:o}}function J(e){let t,r=e[2].data.getMod.name+"";return{c(){t=l(r)},l(e){t=g(e,r)},m(e,r){$(e,t,r)},p(e,o){4&o&&r!==(r=e[2].data.getMod.name+"")&&M(t,r)},d(e){e&&f(t)}}}function K(e){let t;return{c(){t=l("...")},l(e){t=g(e,"...")},m(e,r){$(e,t,r)},p:o,d(e){e&&f(t)}}}function Q(e){let t,r,o,n;t=new C({props:{onSubmit:e[8],modReference:e[2].data.getMod.mod_reference}});let a=e[3]&&B(e);return{c(){d(t.$$.fragment),r=c(),a&&a.c(),o=s()},l(e){v(t.$$.fragment,e),r=h(e),a&&a.l(e),o=s()},m(e,s){V(t,e,s),$(e,r,s),a&&a.m(e,s),$(e,o,s),n=!0},p(e,r){const n={};4&r&&(n.modReference=e[2].data.getMod.mod_reference),t.$set(n),e[3]?a?a.p(e,r):(a=B(e),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},i(e){n||(y(t.$$.fragment,e),n=!0)},o(e){k(t.$$.fragment,e),n=!1},d(e){E(t,e),e&&f(r),a&&a.d(e),e&&f(o)}}}function W(e){let t,r,n,a=e[2].error.message+"";return{c(){t=i("p"),r=l("Oh no... "),n=l(a)},l(e){t=m(e,"P",{});var o=p(t);r=g(o,"Oh no... "),n=g(o,a),o.forEach(f)},m(e,o){$(e,t,o),x(t,r),x(t,n)},p(e,t){4&t&&a!==(a=e[2].error.message+"")&&M(n,a)},i:o,o:o,d(e){e&&f(t)}}}function Z(e){let t,r;return{c(){t=i("p"),r=l("Loading...")},l(e){t=m(e,"P",{});var o=p(t);r=g(o,"Loading..."),o.forEach(f)},m(e,o){$(e,t,o),x(t,r)},p:o,i:o,o:o,d(e){e&&f(t)}}}function B(e){let t,r,o,n,a,s,d,u,v,V,k,b,y,I=e[4].toFixed(0)+"";return{c(){t=i("div"),r=i("div"),o=i("div"),n=i("span"),a=l(e[3]),s=c(),d=i("div"),u=i("span"),v=l(I),V=l("%"),k=c(),b=i("div"),y=i("div"),this.h()},l(c){t=m(c,"DIV",{class:!0});var i=p(t);r=m(i,"DIV",{class:!0});var l=p(r);o=m(l,"DIV",{});var w=p(o);n=m(w,"SPAN",{class:!0});var x=p(n);a=g(x,e[3]),x.forEach(f),w.forEach(f),s=h(l),d=m(l,"DIV",{class:!0});var $=p(d);u=m($,"SPAN",{class:!0});var E=p(u);v=g(E,I),V=g(E,"%"),E.forEach(f),$.forEach(f),l.forEach(f),k=h(i),b=m(i,"DIV",{class:!0});var j=p(b);y=m(j,"DIV",{style:!0,class:!0}),p(y).forEach(f),j.forEach(f),i.forEach(f),this.h()},h(){w(n,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-white bg-yellow-600"),w(u,"class","text-xs font-semibold inline-block text-white"),w(d,"class","text-right"),w(r,"class","flex mb-2 items-center justify-between"),D(y,"width",e[4].toFixed(0)+"%"),w(y,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-600"),w(b,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-600"),w(t,"class","relative pt-4")},m(e,c){$(e,t,c),x(t,r),x(r,o),x(o,n),x(n,a),x(r,s),x(r,d),x(d,u),x(u,v),x(u,V),x(t,k),x(t,b),x(b,y)},p(e,t){8&t&&M(a,e[3]),16&t&&I!==(I=e[4].toFixed(0)+"")&&M(v,I),16&t&&D(y,"width",e[4].toFixed(0)+"%")},d(e){e&&f(t)}}}function X(e){let t,r;return{c(){t=i("span"),r=l(e[1])},l(o){t=m(o,"SPAN",{});var n=p(t);r=g(n,e[1]),n.forEach(f)},m(e,o){$(e,t,o),x(t,r)},p(e,t){2&t&&M(r,e[1])},d(e){e&&f(t)}}}function Y(e){let t,r,o,j,S,P,N,F,M,D,q,A=!e[2].fetching&&!e[2].error&&H(e);function C(e,t){return e[2].fetching?K:e[2].error?void 0:J}let T=C(e),_=T&&T(e);const L=[Z,W,Q],R=[];function O(e,t){return e[2].fetching?0:e[2].error?1:2}function G(t){e[10](t)}P=O(e),N=R[P]=L[P](e);let B={$$slots:{default:[X]},$$scope:{ctx:e}};return void 0!==e[0]&&(B.running=e[0]),M=new z({props:B}),n.push((()=>a(M,"running",G))),{c(){A&&A.c(),t=s(),r=c(),o=i("h1"),j=l("New Version for\n  "),_&&_.c(),S=c(),N.c(),F=c(),d(M.$$.fragment),this.h()},l(e){const n=u('[data-svelte="svelte-xxil0f"]',document.head);A&&A.l(n),t=s(),n.forEach(f),r=h(e),o=m(e,"H1",{class:!0});var a=p(o);j=g(a,"New Version for\n  "),_&&_.l(a),a.forEach(f),S=h(e),N.l(e),F=h(e),v(M.$$.fragment,e),this.h()},h(){w(o,"class","text-4xl my-4 font-bold")},m(e,n){A&&A.m(document.head,null),x(document.head,t),$(e,r,n),$(e,o,n),x(o,j),_&&_.m(o,null),$(e,S,n),R[P].m(e,n),$(e,F,n),V(M,e,n),q=!0},p(e,[r]){e[2].fetching||e[2].error?A&&(A.d(1),A=null):A||(A=H(e),A.c(),A.m(t.parentNode,t)),T===(T=C(e))&&_?_.p(e,r):(_&&_.d(1),_=T&&T(e),_&&(_.c(),_.m(o,null)));let n=P;P=O(e),P===n?R[P].p(e,r):(U(),k(R[n],1,1,(()=>{R[n]=null})),b(),N=R[P],N?N.p(e,r):(N=R[P]=L[P](e),N.c()),y(N,1),N.m(F.parentNode,F));const a={};131074&r&&(a.$$scope={dirty:r,ctx:e}),!D&&1&r&&(D=!0,a.running=e[0],I((()=>D=!1))),M.$set(a)},i(e){q||(y(N),y(M.$$.fragment,e),q=!0)},o(e){k(N),k(M.$$.fragment,e),q=!1},d(e){A&&A.d(e),f(t),e&&f(r),e&&f(o),_&&_.d(),e&&f(S),R[P].d(e),e&&f(F),E(M,e)}}}const ee=q();function te(e,t,r){let o,n,a;var s=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(n,a){function s(e){try{i(o.next(e))}catch(t){a(t)}}function c(e){try{i(o.throw(e))}catch(t){a(t)}}function i(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}i((o=o.apply(e,t||[])).next())}))};let{modId:c}=t;const i=F("");j(e,i,(e=>r(3,n=e)));const l=F(0);j(e,l,(e=>r(4,a=e)));const d=F();d.subscribe((e=>{e&&(e.uploaded===e.total?(i.set("Processing..."),l.set(100)):(i.set(`Uploading: ${e.uploaded}/${e.total}`),l.set(e.uploaded/e.total*100)))}));let u="",f=!1;const h=S(T,{mod:c});j(e,h,(e=>r(2,o=e))),P(h);const m=N({query:L}),p=N({query:R}),g=N({query:O}),v=S(_,{versionId:void 0,modId:c},{pause:!0});P(v);return e.$$set=e=>{"modId"in e&&r(9,c=e.modId)},e.$$.update=()=>{1&e.$$.dirty&&(f||r(1,u=""))},[f,u,o,n,a,i,l,h,e=>s(void 0,void 0,void 0,(function*(){return(async(e,t,r,o,n)=>{const a=1e7,s=Math.ceil(e.size/a),c=new Array(s).fill(0).map(((e,t)=>t)).reverse(),i=(e,r,o)=>n.uploadVersionPart({modId:t,versionId:o,part:r,file:e});let l=0,d=0;const u=t=>{if(l>=10)return;if(!c.length)return;const r=c.pop(),n=r*a,f=e.slice(n,n+a);return l+=1,Promise.all([i(f,r+1,t).then((()=>(l-=1,o.set({total:s,uploaded:s-c.length-l}),u(t)))).catch((e=>{if(console.error("Upload failed:",e),l-=1,c.push(r),d+=1,d<5)return u(t);throw new Error("Failed uploading after 5 attempts")})),u(t)])};return n.createVersion({modId:t}).then((async e=>(o.set({total:s,uploaded:0}),await u(e.data.createVersion),e.data.createVersion))).then((e=>(console.log("Finalizing",{versionID:e}),n.finalizeCreateVersion({modId:t,versionId:e,version:r}).then((()=>new Promise(((t,r)=>{let o=0;const a=setInterval((()=>{if(60==o)return clearInterval(a),r(new Error("Timed out waiting for mod processing"));n.checkVersionUploadState.reexecute({requestPolicy:"network-only"}),o++}),1e4);n.checkVersionUploadState.variables.versionId=e;const s=n.checkVersionUploadState.subscribe((e=>{if(!e.fetching)return e.error?(clearInterval(a),r(new Error(e.error.message)),void setTimeout(s)):void(e.data&&e.data.checkVersionUploadState&&e.data.checkVersionUploadState.version&&e.data.checkVersionUploadState.version.id&&(s(),clearInterval(a),t(e.data.checkVersionUploadState)))}))}))))))).catch((e=>{throw console.error(e),e}))})(e.file,c,{changelog:e.changelog,stability:e.stability},d,{createVersion:m,uploadVersionPart:p,finalizeCreateVersion:g,checkVersionUploadState:v}).then((e=>{console.log({success:e}),A(G+"/mod/"+c+"/version/"+e.version.id)})).catch((e=>{console.error(e),r(1,u="Error creating version: "+e.message),r(0,f=!0),i.set("")}))})),c,function(e){f=e,r(0,f)}]}class re extends e{constructor(e){super(),t(this,e,te,Y,r,{modId:9})}}export{re as default,ee as load};
//# sourceMappingURL=new-version.svelte-6b08d89e.js.map
