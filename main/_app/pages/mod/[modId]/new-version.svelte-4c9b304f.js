import{S as e,i as t,s as r,W as o,X as s,e as a,t as n,k as i,j as c,c as l,a as d,g as u,d as f,n as h,m,b as p,f as g,a1 as v,o as $,u as w,w as x,x as b,Y as V,v as k,Z as y,$ as I,a0 as E,_ as j,r as S,C as P,h as U,a7 as F,aS as D,l as N}from"../../../chunks/vendor-83c23bd8.js";import{p as q}from"../../../chunks/routing-405c8d47.js";import{T as z}from"../../../chunks/Toast-11f90e22.js";import{g as M}from"../../../chunks/navigation-2ffed81e.js";import{V as _}from"../../../chunks/VersionForm-81182729.js";import{C as A,x as C,F as T,y as L,z as O}from"../../../chunks/graphql-71bf8d51.js";import"../../../chunks/singletons-12a22614.js";import"../../../chunks/uplugin-3ba5ee19.js";import"../../../chunks/sha256-88abbcfe.js";import"../../../chunks/user-bb53616c.js";import"../../../chunks/forms-8d025218.js";import"../../../chunks/markdown-ac91d65c.js";function R(e){let t,r=e[2].data.getMod.name+"";return{c(){t=n(r)},l(e){t=u(e,r)},m(e,r){g(e,t,r)},p(e,o){4&o&&r!==(r=e[2].data.getMod.name+"")&&U(t,r)},d(e){e&&f(t)}}}function H(e){let t;return{c(){t=n("...")},l(e){t=u(e,"...")},m(e,r){g(e,t,r)},p:F,d(e){e&&f(t)}}}function W(e){let t,r,o,s;t=new _({props:{onSubmit:e[8],modReference:e[2].data.getMod.mod_reference}});let a=e[3]&&Z(e);return{c(){c(t.$$.fragment),r=i(),a&&a.c(),o=N()},l(e){m(t.$$.fragment,e),r=h(e),a&&a.l(e),o=N()},m(e,n){$(t,e,n),g(e,r,n),a&&a.m(e,n),g(e,o,n),s=!0},p(e,r){const s={};4&r&&(s.modReference=e[2].data.getMod.mod_reference),t.$set(s),e[3]?a?a.p(e,r):(a=Z(e),a.c(),a.m(o.parentNode,o)):a&&(a.d(1),a=null)},i(e){s||(b(t.$$.fragment,e),s=!0)},o(e){w(t.$$.fragment,e),s=!1},d(e){k(t,e),e&&f(r),a&&a.d(e),e&&f(o)}}}function X(e){let t,r,o,s=e[2].error.message+"";return{c(){t=a("p"),r=n("Oh no... "),o=n(s)},l(e){t=l(e,"P",{});var a=d(t);r=u(a,"Oh no... "),o=u(a,s),a.forEach(f)},m(e,s){g(e,t,s),v(t,r),v(t,o)},p(e,t){4&t&&s!==(s=e[2].error.message+"")&&U(o,s)},i:F,o:F,d(e){e&&f(t)}}}function Y(e){let t,r;return{c(){t=a("p"),r=n("Loading...")},l(e){t=l(e,"P",{});var o=d(t);r=u(o,"Loading..."),o.forEach(f)},m(e,o){g(e,t,o),v(t,r)},p:F,i:F,o:F,d(e){e&&f(t)}}}function Z(e){let t,r,o,s,c,m,$,w,x,b,V,k,y,I=e[4].toFixed(0)+"";return{c(){t=a("div"),r=a("div"),o=a("div"),s=a("span"),c=n(e[3]),m=i(),$=a("div"),w=a("span"),x=n(I),b=n("%"),V=i(),k=a("div"),y=a("div"),this.h()},l(a){t=l(a,"DIV",{class:!0});var n=d(t);r=l(n,"DIV",{class:!0});var i=d(r);o=l(i,"DIV",{});var p=d(o);s=l(p,"SPAN",{class:!0});var g=d(s);c=u(g,e[3]),g.forEach(f),p.forEach(f),m=h(i),$=l(i,"DIV",{class:!0});var v=d($);w=l(v,"SPAN",{class:!0});var E=d(w);x=u(E,I),b=u(E,"%"),E.forEach(f),v.forEach(f),i.forEach(f),V=h(n),k=l(n,"DIV",{class:!0});var j=d(k);y=l(j,"DIV",{style:!0,class:!0}),d(y).forEach(f),j.forEach(f),n.forEach(f),this.h()},h(){p(s,"class","text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full text-white bg-yellow-600"),p(w,"class","text-xs font-semibold inline-block text-white"),p($,"class","text-right"),p(r,"class","flex mb-2 items-center justify-between"),D(y,"width",e[4].toFixed(0)+"%"),p(y,"class","shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-yellow-600"),p(k,"class","overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-600"),p(t,"class","relative pt-4")},m(e,a){g(e,t,a),v(t,r),v(r,o),v(o,s),v(s,c),v(r,m),v(r,$),v($,w),v(w,x),v(w,b),v(t,V),v(t,k),v(k,y)},p(e,t){8&t&&U(c,e[3]),16&t&&I!==(I=e[4].toFixed(0)+"")&&U(x,I),16&t&&D(y,"width",e[4].toFixed(0)+"%")},d(e){e&&f(t)}}}function B(e){let t,r;return{c(){t=a("span"),r=n(e[1])},l(o){t=l(o,"SPAN",{});var s=d(t);r=u(s,e[1]),s.forEach(f)},m(e,o){g(e,t,o),v(t,r)},p(e,t){2&t&&U(r,e[1])},d(e){e&&f(t)}}}function G(e){let t,r,y,I,E,j,P,U,F;function D(e,t){return e[2].fetching?H:e[2].error?void 0:R}let N=D(e),q=N&&N(e);const M=[Y,X,W],_=[];function A(e,t){return e[2].fetching?0:e[2].error?1:2}function C(t){e[10](t)}I=A(e),E=_[I]=M[I](e);let T={$$slots:{default:[B]},$$scope:{ctx:e}};return void 0!==e[0]&&(T.running=e[0]),P=new z({props:T}),o.push((()=>s(P,"running",C))),{c(){t=a("h1"),r=n("New Version for\n  "),q&&q.c(),y=i(),E.c(),j=i(),c(P.$$.fragment),this.h()},l(e){t=l(e,"H1",{class:!0});var o=d(t);r=u(o,"New Version for\n  "),q&&q.l(o),o.forEach(f),y=h(e),E.l(e),j=h(e),m(P.$$.fragment,e),this.h()},h(){p(t,"class","text-4xl my-4 font-bold")},m(e,o){g(e,t,o),v(t,r),q&&q.m(t,null),g(e,y,o),_[I].m(e,o),g(e,j,o),$(P,e,o),F=!0},p(e,[r]){N===(N=D(e))&&q?q.p(e,r):(q&&q.d(1),q=N&&N(e),q&&(q.c(),q.m(t,null)));let o=I;I=A(e),I===o?_[I].p(e,r):(S(),w(_[o],1,1,(()=>{_[o]=null})),x(),E=_[I],E?E.p(e,r):(E=_[I]=M[I](e),E.c()),b(E,1),E.m(j.parentNode,j));const s={};131074&r&&(s.$$scope={dirty:r,ctx:e}),!U&&1&r&&(U=!0,s.running=e[0],V((()=>U=!1))),P.$set(s)},i(e){F||(b(E),b(P.$$.fragment,e),F=!0)},o(e){w(E),w(P.$$.fragment,e),F=!1},d(e){e&&f(t),q&&q.d(),e&&f(y),_[I].d(e),e&&f(j),k(P,e)}}}const J=q();function K(e,t,r){let o,s,a;var n=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,a){function n(e){try{c(o.next(e))}catch(t){a(t)}}function i(e){try{c(o.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,i)}c((o=o.apply(e,t||[])).next())}))};let{modId:i}=t;const c=P("");y(e,c,(e=>r(3,s=e)));const l=P(0);y(e,l,(e=>r(4,a=e)));const d=P();d.subscribe((e=>{e&&(e.uploaded===e.total?(c.set("Processing..."),l.set(100)):(c.set(`Uploading: ${e.uploaded}/${e.total}`),l.set(e.uploaded/e.total*100)))}));let u="",f=!1;const h=I(L,{mod:i});y(e,h,(e=>r(2,o=e))),E(h);const m=j({query:A}),p=j({query:C}),g=j({query:T}),v=I(O,{versionId:void 0,modId:i},{pause:!0});E(v);return e.$$set=e=>{"modId"in e&&r(9,i=e.modId)},e.$$.update=()=>{1&e.$$.dirty&&(f||r(1,u=""))},[f,u,o,s,a,c,l,h,e=>n(void 0,void 0,void 0,(function*(){return(async(e,t,r,o,s)=>{const a=1e7,n=Math.ceil(e.size/a),i=new Array(n).fill(0).map(((e,t)=>t)).reverse(),c=(e,r,o)=>s.uploadVersionPart({modId:t,versionId:o,part:r,file:e});let l=0,d=0;const u=t=>{if(l>=10)return;if(!i.length)return;const r=i.pop(),s=r*a,f=e.slice(s,s+a);return l+=1,Promise.all([c(f,r+1,t).then((()=>(l-=1,o.set({total:n,uploaded:n-i.length-l}),u(t)))).catch((e=>{if(console.error("Upload failed:",e),l-=1,i.push(r),d+=1,d<5)return u(t);throw new Error("Failed uploading after 5 attempts")})),u(t)])};return s.createVersion({modId:t}).then((async e=>(o.set({total:n,uploaded:0}),await u(e.data.createVersion),e.data.createVersion))).then((e=>(console.log("Finalizing",{versionID:e}),s.finalizeCreateVersion({modId:t,versionId:e,version:r}).then((()=>new Promise(((t,r)=>{let o=0;const a=setInterval((()=>{if(60==o)return clearInterval(a),r(new Error("Timed out waiting for mod processing"));s.checkVersionUploadState.reexecute({requestPolicy:"network-only"}),o++}),1e4);s.checkVersionUploadState.variables.versionId=e;const n=s.checkVersionUploadState.subscribe((e=>{if(!e.fetching)return e.error?(clearInterval(a),r(new Error(e.error.message)),void setTimeout(n)):void(e.data&&e.data.checkVersionUploadState&&e.data.checkVersionUploadState.version&&e.data.checkVersionUploadState.version.id&&(n(),clearInterval(a),t(e.data.checkVersionUploadState)))}))}))))))).catch((e=>{throw console.error(e),e}))})(e.file,i,{changelog:e.changelog,stability:e.stability},d,{createVersion:m,uploadVersionPart:p,finalizeCreateVersion:g,checkVersionUploadState:v}).then((e=>{console.log({success:e}),M("/mod/"+i+"/version/"+e.version.id)})).catch((e=>{console.error(e),r(1,u="Error creating version: "+e.message),r(0,f=!0),c.set("")}))})),i,function(e){f=e,r(0,f)}]}class Q extends e{constructor(e){super(),t(this,e,K,G,r,{modId:9})}}export{Q as default,J as load};
